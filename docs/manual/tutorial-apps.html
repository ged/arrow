<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!--

		Arrow Manual: Tutorial: Applets
		$Id$

		Author:		Michael Granger
		Time-stamp: <23-Apr-2001 19:58:12 deveiant>

  -->

  <head>
	<title>Arrow Manual: Tutorial: Applets</title>

	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />

    <meta name="authors" content="Michael Granger (ged@FaerieMUD.org)>" />
	<link rel="stylesheet" href="manual.css" type="text/css" />
  </head>
  <body>

	<!--#include virtual="linkbox.incl" -->
	<!--#include virtual="tutorial-linkbox.incl" -->

  <!-- Main content -->
	<div id="content">
	  <h1>Arrow: Tutorial: Applets</h1>

	  <p>The <tt>Arrow::Applet</tt> class is the main workhorse of the
		Arrow framework; it, in concert with <tt>Arrow::Transaction</tt>,
		provides most of the functionality that application developers will be
		concerned with.</p>

	  <p>Applets make up the <em>actions</em> of a application; each distinct
		task that a user can do is expressed as a separate class which inherits
		from Arrow::Applet. The base Applet class defines much of what is
		covered in the rest of this tutorial, so if you don't like the
		templating system built into the base applet class, you can define your
		own that uses one of the other excellent templating modules available on
		the RAA or elsewhere.</p>

	  <p>For now, though, this tutorial will focus on the default functionality,
		with mention made of how to override or replace it where
		appropriate.</p>

	  <div class="section">
		<h2><a href="#overview" id="overview">The Parts of an Applet</a></h2>

		<p>An Arrow applet is made up of <strong>a signature</strong>, one or more
		  <strong>actions</strong>, and an optional <strong>delegator
		  method</strong>.</p>
	  </div>

	  <!-- The Signature -->
	  <div class="section">
		<h2><a href="#signature" id="signature">The Signature</a></h2>

		<p>The <strong>signature</strong> is a Hash of metadata which describes
		  the applet to its container object (the Broker), and includes
		  information like where to install it in relation to the rest of the
		  hierarchy of applets, and configures some of the logic and
		  functionality provided by the <tt>Arrow::Applet</tt> class itself.</p>
		
		<pre>
# Applet signature
Signature = {
    :uri => "hello",
    :name => "Hello World",
    :description => "This is yet another implementation of Hello World",
    :maintainer => "ged@FaerieMUD.org",
    :defaultAction => 'greet',
}
</pre>

		<h3>Signature Values</h3>
		<dl class="linelist signature-items">
		  <dt>uri (required)</dt>
		  <dd>A relative URI string which will be used to refer to the
			applet in relation to the application's base URL. This value can
			also be used to specify one or more other applets which should be
			called before it itself is run, which is called <a
			href="#chaining">applet chaining</a>.</dd>

		  <dd>This is the only mandatory element of the signature -- the rest of
			the elements will be given reasonable defaults if they are
			unspecified.</dd>

		  <dt>name</dt>
		  <dd>The name of the applet, used for display purposes in
			introspection. Defaults to the name of the Applet class.</dd>

		  <dt>description</dt>
		  <dd>A brief explanation of what the applet does or is for; used
			in introspection utilities. Defaults to <tt>"(none)"</tt>.</dd>

		  <dt>maintainer</dt>
		  <dd>The RFC822-formatted email address of the person to praise and/or
			blame for the functioning of the applet. This is intended to be
			used in introspection utilities and also for automated bug or error
			reporting. Defaults to whatever the <tt>ServerAdmin</tt> of Apache
			is set to, or the empty string if the <tt>ServerAdmin</tt> setting
			is not available.</dd>

		  <dt>defaultAction</dt>
		  <dd>When no action is specified, this determines which one will be
			used. Defaults to <tt>'_default'</tt>.</dd>

		  <dt>templates</dt>
		  <dd>This should be set to a hash filled with file names of the
			templates that will be used by this applet.  We recommend
			keying the hash with either symbols or strings, for easy
			reference. Defaults to an empty hash.</dd>

		  <dt>version</dt>
		  <dd>The version of the applet. If the applet defines any of
			the <tt>Version</tt>, <tt>Revision</tt>, or <tt>Rcsid</tt>
			constants, the value it contains is used as a default. Otherwise the
			mtime of the file which contains the applet is used.</dd>

		  <dt>config</dt>
		  <dd>A hash of applet configuration values which can be tuned from
			the applet server's introspection interfaces.</dd>

		  <dt>vargs</dt>
		  <dd>A hash containing profiles for the built in form validator, one
			per action. See the <a href="tutorial-validation.html">input
			validation section</a> of the tutorial for more.</dd>

		  <dt>monitors</dt>
		  <dd>A hash of monitor objects that can be used for introspection,
			debugging, profiling, and tuning the applet. The keys are
			symbol identifiers which will be used later when using the
			configured monitors. See the <a
			href="tutorial-monitors.html">"monitors" section</a> of the tutorial
			for more.</dd>
		</dl>
	  </div>

	  <!-- Actions -->
	  <div class="section">
		<h2><a href="#actions" id="actions">Actions</a></h2>

		<p>Actions provide the actual functionality of the applet. An
		  action is just a specially-named method which corresponds to a part of
		  the URI the client requests, and represents a step or phase of the
		  applet's execution.</p>

		<h3>Action Method Form</h3>
		<p>Each action method's name must begin with a unique name by which it
		  will be invoked, and end with <tt>_action</tt>. For example, if you're
		  defining the 'display' action, you'd define a method called
		  <tt>display_action</tt>:</p>

<pre>
def display_action( txn, *args )
  # Do something with the txn

  return "Some content"
end
</pre>

		<p>Action methods are called with an Arrow::Transaction object and zero
		  or more arguments that can be passed REST-style in the URI. Only the
		  transaction argument is mandatory; defining an action method without
		  parameters will result in an error.</p>

		<p>You can also use the <tt>action</tt> shortcut to define an action,
		  like so:</p>

<pre>
action( :display ) {|txn|
  # Do something with the txn

  return "Some content"
}	
</pre>


		<h3>Action Signature Proxy</h3>

		<p>For convenience, the <tt>action</tt> shortcut also returns an
		  object...</p>


		<h3>Action Execution</h3>

		<p>When the <tt>Broker</tt> runs the applet, it does so by calling
		  <tt>Applet#run</tt> with the <tt>Arrow::Transaction</tt> object, the
		  name of the action to invoke, and any additional arguments passed in
		  the URI.</p>

		<p>The applet's <tt>#run</tt> method looks up the appropriate action
		  method, loads the app's templates, creates an argument validator, then
		  calls the action method.</p>

		<p>The action method should do the necessary processing to build the
		  response data and return it as one or more objects. These objects will
		  then be converted to strings and catenated together, and sent to the
		  client after doing the necessary header and Apache
		  housekeeping. Returning a non-true value causes a <tt>DECLINED</tt>
		  status to be sent back to Apache. This can be used to pass control to
		  a further handler if the action determines it cannot handle the
		  request.</p>
	  </div>

	  <!-- Example -->
	  <div class="section example-section">
		<h2><a href="#hello-example" id="hello-example">A simple
			applet - Hello</a></h2>

		<p>We'll start with a dead-simple applet that doesn't really do
		  much of anything useful. In keeping with tradition, of course, this
		  applet will be yet another implementation of 'Hello World'.</p>

<pre>
#
# A "hello world" Arrow applet
#

require 'arrow/applet'

# Define the applet class; inherit from the base applet class.
class Hello &lt; Arrow::Applet

  # Applet signature
  Signature = {
	  :uri =&gt; "hello",
	  :name =&gt; "Hello World",
	  :description =&gt; "This is yet another implementation of Hello World",
	  :maintainer =&gt; "ged@FaerieMUD.org",
	  :defaultAction =&gt; 'greet',
  }

  # Define the 'greet' (default) action
  action( :greet ) {|txn|
    return &lt;&lt;-EOF
	&lt;html&gt;
	  &lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;
	  &lt;body&gt;&lt;p&gt;Hello, world.&lt;/p&gt;&lt;/body&gt;
	&lt;/html&gt;
    EOF
  }

end
</pre>

	  </div>

	  <!-- Delegation Method -->
	  <div class="section">
		<h2><a href="#delegation" id="delegation">Delegation Method</a></h2>

		<p>As mentioned before, applets can also be chained together to build
		  more complex functionality. Apps which are intended to be chained
		  through should define a <tt>#delegate</tt> method. This delegation
		  method is called by the broker when the applet is being chained
		  through, and is responsible for calling <tt>yield</tt> when (if) it
		  wishes to pass control to the next applet in the chain, passing any
		  desired additional arguments. Delegation methods are invoked with the
		  same arguments as action methods, with the addition of any arguments
		  yielded to it by any previous applet in the chain.</p>
	  </div>
	  

	  <div class="section">
		<h2><a href="#subclass" id="subclass">Subclassing Arrow::Applet</a></h2>
		<p></p>
		<h3>#run</h3>
		<p></p>
		<h3>#delegate</h3>
		<p></p>
	  </div>

	  <div class="section">
		<h2><a href="#chaining" id="chaining">Applet Chaining</a></h2>
		<p></p>
		<h3>?(example)?</h3>
		<p></p>
	  </div>

	  <div class="section">
		<h2><a href="#special" id="special">Special Applets</a></h2>
		<p></p>
		<h3>Internal-only Applets</h3>
		<p></p>
		<h3>Error Handlers</h3>
		<p></p>
		<h3>Status/Introspection Applets</h3>
		<p></p>
	  </div>

	</div>

  </body>
</html>


<!--
  Local Variables:
  mode: xml
 -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<!--

  Arrow Broker Filemap Display

  -->

  <head>
	<title>Arrow Broker Filemap Display</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link rel="stylesheet" type="text/css" href="/css/arrow.css" />

	<script type="text/javascript">
	  <!--
	  function toggle( id ) {
		if ( !document.getElementById ) return;

		target = document.getElementById( id );
		if ( typeof target == "undefined" ) return;

		if ( target.style.display == "block" ) {
			target.style.display = "none";
		} else {
			target.style.display = "block";
		}

		return false;
	  }
	  // -->
	</script>
  </head>
  <body>

	<h1>Arrow Broker Filemap Display</h1>
	<p><?call txn.broker.registry.filemap.length ?> Applet Files Examined</p>

	<?for filename, appletfile in txn.broker.registry.filemap.sort_by {|key,val| key} ?>

	<div class="filemap-entry">
	  <h3 class="filemap-filename"><?call filename ?></h3>

	  <?if appletfile.exception ?>
	  <!-- Exception while loading -->
	  <div class="filemap-exception-content">
		<strong>Exception while loading:</strong>&nbsp;
		<span class="toggle-button" onclick="toggle('exc-[?call appletfile.exception.object_id?]')">expand</span><br />
		<pre><?escape appletfile.exception.message ?></pre>
		<div id="exc-[?call appletfile.exception.object_id ?]" class="filemap-exception-backtrace">
		  <?for frame in appletfile.exception.backtrace ?>
		  <code class="filemap-exception-frame"><?escape frame ?></code><br/>
		  <?end for?>
		</div>
	  </div>

	  <?else?>
	  <!-- Loaded okay -->
	
	  <div class="filemap-normal-content">
		<div class="filemap-uris">
			<strong>URIs:</strong> 
			<!-- ?call appletfile.uris.sort.join(";") ? -->
		</div>
		<div class="filemap-classes">
			<strong>Classes:</strong> 
			<?escape appletfile.appletclasses.collect {|cl| cl.normalized_name}.sort.join(";") ?>
		</div>
		<div class="filemap-timestamp">
			<strong>Timestamp:</strong> <?call appletfile.timestamp.ctime ?>
		</div>
	  </div>
	  <?end if ?>

	</div>
	<?end for ?>

	<?include navbar.incl?>

  </body>
</html>


<!--
  Local Variables:
  mode: nxml
 -->

